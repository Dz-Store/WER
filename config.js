// config.js - Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ
let STORE_CONFIG = {
  "PRODUCTS": {
    "1": {
      "name": "Ù…ÙˆØ¯Ø§Ù„ 1",
      "price": 3300,
      "image": "https://i.ibb.co/wFhBNhmf/modal6-jpg.webp",
      "description": "ØªØµÙ…ÙŠÙ… Ù…Ø±ÙŠØ­ ÙˆØ¹ØµØ±ÙŠ Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø±Ø§Ù‚ÙŠØ© ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª",
      "availableColors": [
        "ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©"
      ],
      "availableSizes": [
        "M",
        "L"
      ]
    },
    "2": {
      "name": "Ù…ÙˆØ¯Ø§Ù„ 14",
      "price": 5200,
      "image": "https://raw.githubusercontent.com/Ahcene43/Inas/main/images/1760731352265-modal6.jpg",
      "description": "Ù…ÙˆØ¯Ø§Ù„ Ø´ØªÙˆÙŠ ÙØ§Ø®Ø±",
      "availableSizes": [
        "S",
        "M",
        "L",
        "XL",
        "XXL",
        "S1"
      ],
      "availableColors": [
        "ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©",
        "Ø£Ø¨ÙŠØ¶",
        "Ø£Ø³ÙˆØ¯",
        "Ø±Ù…Ø§Ø¯ÙŠ"
      ]
    }
  },
  "DELIVERY_PRICES": {
    "01 - Ø£Ø¯Ø±Ø§Ø±": {
      "home": 1100,
      "desk": 600
    },
    "02 - Ø§Ù„Ø´Ù„Ù": {
      "home": 700,
      "desk": 400
    },
    "03 - Ø§Ù„Ø£ØºÙˆØ§Ø·": {
      "home": 900,
      "desk": 500
    },
    "04 - Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ": {
      "home": 650,
      "desk": 400
    },
    "05 - Ø¨Ø§ØªÙ†Ø©": {
      "home": 700,
      "desk": 400
    },
    "06 - Ø¨Ø¬Ø§ÙŠØ©": {
      "home": 700,
      "desk": 400
    },
    "07 - Ø¨Ø³ÙƒØ±Ø©": {
      "home": 900,
      "desk": 500
    },
    "08 - Ø¨Ø´Ø§Ø±": {
      "home": 1100,
      "desk": 600
    },
    "09 - Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©": {
      "home": 500,
      "desk": 250
    },
    "10 - Ø§Ù„Ø¨ÙˆÙŠØ±Ø©": {
      "home": 700,
      "desk": 400
    },
    "11 - ØªÙ…Ù†Ø±Ø§Ø³Øª": {
      "home": 1300,
      "desk": 800
    },
    "12 - ØªØ¨Ø³Ø©": {
      "home": 700,
      "desk": 400
    },
    "13 - ØªÙ„Ù…Ø³Ø§Ù†": {
      "home": 800,
      "desk": 400
    },
    "14 - ØªÙŠØ§Ø±Øª": {
      "home": 800,
      "desk": 400
    },
    "15 - ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ": {
      "home": 700,
      "desk": 400
    },
    "16 - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±": {
      "home": 500,
      "desk": 250
    },
    "17 - Ø§Ù„Ø¬Ù„ÙØ©": {
      "home": 900,
      "desk": 500
    },
    "18 - Ø¬ÙŠØ¬Ù„": {
      "home": 700,
      "desk": 400
    },
    "19 - Ø³Ø·ÙŠÙ": {
      "home": 700,
      "desk": 400
    },
    "20 - Ø³Ø¹ÙŠØ¯Ø©": {
      "home": 800,
      "desk": 400
    },
    "21 - Ø³ÙƒÙŠÙƒØ¯Ø©": {
      "home": 600,
      "desk": 400
    },
    "22 - Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³": {
      "home": 700,
      "desk": 400
    },
    "23 - Ø¹Ù†Ø§Ø¨Ø©": {
      "home": 700,
      "desk": 400
    },
    "24 - Ù‚Ø§Ù„Ù…Ø©": {
      "home": 600,
      "desk": 400
    },
    "25 - Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©": {
      "home": 600,
      "desk": 400
    },
    "26 - Ø§Ù„Ù…Ø¯ÙŠØ©": {
      "home": 700,
      "desk": 400
    },
    "27 - Ù…Ø³ØªØºØ§Ù†Ù…": {
      "home": 700,
      "desk": 400
    },
    "28 - Ø§Ù„Ù…Ø³ÙŠÙ„Ø©": {
      "home": 800,
      "desk": 400
    },
    "29 - Ù…Ø¹Ø³ÙƒØ±": {
      "home": 700,
      "desk": 400
    },
    "30 - ÙˆØ±Ù‚Ù„Ø©": {
      "home": 900,
      "desk": 500
    },
    "31 - ÙˆÙ‡Ø±Ø§Ù†": {
      "home": 800,
      "desk": 400
    },
    "32 - Ø§Ù„Ø¨ÙŠØ¶": {
      "home": 800,
      "desk": 500
    },
    "33 - Ø¥Ù„ÙŠØ²ÙŠ": {
      "home": 1300,
      "desk": 600
    },
    "34 - Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬": {
      "home": 700,
      "desk": 400
    },
    "35 - Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³": {
      "home": 700,
      "desk": 400
    },
    "36 - Ø§Ù„Ø·Ø§Ø±Ù": {
      "home": 700,
      "desk": 400
    },
    "37 - ØªÙ†Ø¯ÙˆÙ": {
      "home": 1300,
      "desk": 600
    },
    "38 - ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª": {
      "home": 800,
      "desk": 400
    },
    "39 - Ø§Ù„ÙˆØ§Ø¯ÙŠ": {
      "home": 900,
      "desk": 500
    },
    "40 - Ø®Ù†Ø´Ù„Ø©": {
      "home": 700,
      "desk": 500
    },
    "41 - Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³": {
      "home": 700,
      "desk": 400
    },
    "42 - ØªÙŠØ¨Ø§Ø²Ø©": {
      "home": 700,
      "desk": 400
    },
    "43 - Ù…ÙŠÙ„Ø©": {
      "home": 500,
      "desk": 350
    },
    "44 - Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰": {
      "home": 700,
      "desk": 400
    },
    "45 - Ø§Ù„Ù†Ø¹Ø§Ù…Ø©": {
      "home": 800,
      "desk": 500
    },
    "46 - Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª": {
      "home": 800,
      "desk": 400
    },
    "47 - ØºØ±Ø¯Ø§ÙŠØ©": {
      "home": 900,
      "desk": 500
    },
    "48 - ØºÙ„ÙŠØ²Ø§Ù†": {
      "home": 700,
      "desk": 400
    },
    "49 - ØªÙŠÙ…ÙŠÙ…ÙˆÙ†": {
      "home": 1100,
      "desk": 600
    },
    "50 - Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±": {
      "home": 1200,
      "desk": 650
    },
    "51 - Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„": {
      "home": 900,
      "desk": 500
    },
    "52 - Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³": {
      "home": 1100,
      "desk": 600
    },
    "53 - Ø¹ÙŠÙ† ØµØ§Ù„Ø­": {
      "home": 1300,
      "desk": 700
    },
    "54 - Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…": {
      "home": 1300,
      "desk": 700
    },
    "55 - ØªÙˆÙ‚Ø±Øª": {
      "home": 950,
      "desk": 550
    },
    "56 - Ø¬Ø§Ù†Øª": {
      "home": 1100,
      "desk": 500
    },
    "57 - Ø§Ù„Ù…ØºÙŠØ±": {
      "home": 950,
      "desk": 550
    },
    "58 - Ø§Ù„Ù…Ù†ÙŠØ¹Ø©": {
      "home": 1000,
      "desk": 600
    }
  },
  "DISCOUNTS": {
    "minQuantityForDiscount": 3,
    "discountPerItem": 300
  },
  "STORE_INFO": {
    "name": "RIHAB12-Shopp",
    "tagline": "Ù…ØªØ¬Ø± Ø£ÙØ®Ù… Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
    "phoneNumbers": [
      "0671466489",
      "0551102155"
    ]
  },
  "AGE_SIZES": {
    "6": "S1",
    "7": "S",
    "8": "M",
    "9": "L",
    "10": "XL",
    "11": "XXL",
    "12": "S4"
  },
  "AVAILABLE_COLORS": [
    "ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©",
    "Ø£Ø¨ÙŠØ¶",
    "Ø£Ø³ÙˆØ¯",
    "Ø±Ù…Ø§Ø¯ÙŠ",
    "Ø£Ø²Ø±Ù‚",
    "Ø£Ø­Ù…Ø±",
    "Ø£Ø®Ø¶Ø±",
    "Ø²Ù‡Ø±ÙŠ",
    "Ø¨Ù†ÙØ³Ø¬ÙŠ"
  ],
  "AVAILABLE_SIZES": [
    "S",
    "M",
    "L",
    "XL",
    "XXL",
    "S1"
  ]
};

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† GitHub
async function loadRemoteConfig(tokenConfig = null, repo = null) {
  try {
    let configUrl;
    
    if (tokenConfig && repo) {
      configUrl = `https://raw.githubusercontent.com/${tokenConfig.username}/${repo}/${tokenConfig.branch || 'main'}/config.json?t=${Date.now()}`;
    } else {
      configUrl = 'https://raw.githubusercontent.com/Ahcene43/WAW/main/config.json?t=' + Date.now();
    }
    
    console.log('ðŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù†:', configUrl);
    const response = await fetch(configUrl);
    
    if (response.ok) {
      const remoteConfig = await response.json();
      STORE_CONFIG = remoteConfig;
      saveConfig(STORE_CONFIG);
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† GitHub');
      
      // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ù…Ø®ØµØµ Ù„Ù„ØªØ­Ø¯ÙŠØ«
      window.dispatchEvent(new CustomEvent('configUpdated', { detail: STORE_CONFIG }));
      
      return true;
    }
  } catch (error) {
    console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø®Ø·Ø£:', error);
  }
  return false;
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
function loadConfig() {
  const saved = localStorage.getItem('storeConfig');
  if (saved) {
    try {
      const parsedConfig = JSON.parse(saved);
      STORE_CONFIG = parsedConfig;
      console.log('ðŸ“‚ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
    } catch (e) {
      console.error('Error loading config:', e);
    }
  }
  return STORE_CONFIG;
}

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
function saveConfig(config = STORE_CONFIG) {
  try {
    localStorage.setItem('storeConfig', JSON.stringify(config));
    STORE_CONFIG = config;
    console.log('ðŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹');
  } catch (error) {
    console.error('Error saving config locally:', error);
  }
}

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub
async function saveToGitHub(config, tokenConfig, repo) {
  try {
    if (!tokenConfig || !tokenConfig.token || !tokenConfig.username || !repo) {
      throw new Error('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
    }

    const content = btoa(unescape(encodeURIComponent(JSON.stringify(config, null, 2))));
    const branch = tokenConfig.branch || 'main';
    
    console.log('ðŸ”¼ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub:', { repo, branch, username: tokenConfig.username });
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù€ SHA Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
    let sha = '';
    try {
      const existingFileResponse = await fetch(
        `https://api.github.com/repos/${tokenConfig.username}/${repo}/contents/config.json`,
        {
          headers: {
            'Authorization': `token ${tokenConfig.token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        }
      );
      
      if (existingFileResponse.ok) {
        const fileData = await existingFileResponse.json();
        sha = fileData.sha;
        console.log('ðŸ“ ÙˆØ¬Ø¯Ù†Ø§ Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡');
      }
    } catch (error) {
      console.log('ðŸ“„ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯');
    }

    const response = await fetch(
      `https://api.github.com/repos/${tokenConfig.username}/${repo}/contents/config.json`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `token ${tokenConfig.token}`,
          'Content-Type': 'application/json',
          'Accept': 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: 'ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± - ' + new Date().toLocaleString('ar-EG'),
          content: content,
          sha: sha,
          branch: branch
        })
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      const errorMsg = errorData.message || `ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ GitHub: ${response.status}`;
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub:', errorMsg);
      throw new Error(errorMsg);
    }

    const result = await response.json();
    console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ GitHub Ø¨Ù†Ø¬Ø§Ø­:', result);
    return result;
  } catch (error) {
    console.error('âŒ Error saving to GitHub:', error);
    throw error;
  }
}

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹ Ø§Ù„ØªÙˆÙƒÙ†
async function loadRemoteConfigWithToken(tokenConfig, repo) {
  return await loadRemoteConfig(tokenConfig, repo);
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
loadConfig();

// Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
setTimeout(() => {
  loadRemoteConfig();
}, 1000);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
setInterval(() => {
  console.log('ðŸ”„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª...');
  loadRemoteConfig();
}, 60000);
